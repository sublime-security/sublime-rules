name: "Unauthorized Telegram Links From External Sources"
description: "Detects messages containing Telegram-related URLs that originate from senders outside of legitimate Telegram domains. Additional checks verify DMARC authentication for trusted senders."
type: "rule"
severity: "low"
source: |
   type.inbound
   // Check for Telegram links in body text
   and (
     any([body.current_thread.text, body.html.raw, body.plain.raw],
         regex.icontains(., 'https?://t\.me/')
         or regex.icontains(., 'https?://telegram\.org')
         or regex.icontains(., 'https?://telegram\.com')
     )
     // Or check for Telegram links in email links
     or any(body.links,
            .href_url.domain.root_domain == 't.me'
            or .href_url.domain.root_domain == 'telegram.org'
            or .href_url.domain.root_domain == 'telegram.com'
     )
   )
   // Negate highly trusted sender domains unless they fail DMARC authentication
   and (
     (
       sender.email.domain.root_domain in $high_trust_sender_root_domains
       and not headers.auth_summary.dmarc.pass
     )
     or sender.email.domain.root_domain not in $high_trust_sender_root_domains
   )
   // Negate legitimate Telegram domains
   and sender.email.domain.root_domain not in (
     "telegram.org",
     "telegram.com",
     "t.me"
   )
tags:
 - "Attack surface reduction"
attack_types:
  - "BEC/Fraud"
  - "Callback Phishing"
  - "Credential Phishing"
  - "Extortion"
  - "Malware/Ransomware"
  - "Spam"
tactics_and_techniques:
  - "Social engineering"
detection_methods:
  - "Content analysis"
  - "Header analysis"
  - "URL analysis"
