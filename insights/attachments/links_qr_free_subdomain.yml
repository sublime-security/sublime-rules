name: "QR code link to free subdomain in attachments"
type: "query"
source: |
  map(filter(attachments, .file_type in $file_types_images or .file_type == "pdf"),
      map(filter(file.explode(.),
                 .scan.qr.type == "url"
                 and .scan.qr.url.domain.root_domain in $free_subdomain_hosts
                 and .scan.qr.url.domain.subdomain is not null
                 and .scan.qr.url.domain.subdomain != "www"
          ),
          .scan.qr.url.url
      )
  )
severity: "high"
