name: "Links in attachments"
type: "query"
source: |
  filter(map(attachments,
           map(file.explode(.),
               distinct(map(filter(.scan.url.urls,
                                   .domain.domain not in~ (
                                     "schemas.openxmlformats.org",
                                     "schemas.microsoft.com",
                                     "purl.org",
                                     "www.w3.org",
                                     "purl.oclc.org"
                                   )
                            ),
                            .url
                        ),
                        .
               )
           )
       ),
       length(.) > 0
  )
severity: "informational"
