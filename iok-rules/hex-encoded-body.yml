attack_types:
- Credential Phishing
description: 'To evade static analysis, the document body can returned hex encoded
  in the response

  where JavaScript can decode it and append it to the DOM.


  This helps defeat simple scanners which don''t evaluate JavaScript.


  Converted from IOK rule - original focuses on website analysis.'
detection_methods:
- Content analysis
- Sender analysis
- Header analysis
- URL analysis
id: 4e8f6255-6381-4722-b7ed-4c1363dfa20f
name: 'IOK: Hex-encoded document body'
severity: high
tactics_and_techniques:
- Social engineering
tags:
- IOK_Converted
- IOK_anti-analysis
type: rule
source: |
  type.inbound
    and any(triage.flagged_rules, any(.detection_methods, ..name == "URL analysis"))
    and any(body.links,
      strings.icontains(ml.link_analysis(.).final_dom.raw, "document.write(unescape(")
    )
    and (
      strings.icontains(subject.subject, "account")
      or strings.icontains(subject.subject, "verify")
      or strings.icontains(subject.subject, "suspended")
    )
    and (
      not profile.by_sender().solicited
      or (
        profile.by_sender().any_messages_malicious_or_spam
        and not profile.by_sender().any_false_positives
      )
    )
