name: "Phishing: MetaMask Impersonation with Suspicious Links"
description: |
  Detects phishing attempts impersonating metamask, with suspicious link(s)
references:
  - "https://metamask.zendesk.com/hc/en-us/articles/12683145255835-I-received-an-email-claiming-to-be-from-MetaMask-Is-it-legit-"
type: "rule"
severity: "medium"
source: |
  type.inbound
  and any([sender.display_name, subject.subject],
    regex.icontains(., '[MĞœâ…¯ğ•„ğ”ğ— ğ™ˆğ™¢ğ™¼ğš–][eâ…´ğ‘’ğ’†ğ“”ğ”¢ğ•–ğ•–ğ–Šğ–Šğ—²ğ˜€ğ™€ğšğœ…ğ´ğ®][tğ‘‡ğ’•ğ“£ğ”—ğ•¥ğ•¥ğ–™ğ–™ğ˜µğšƒğ›•ğ‰ğƒğ£][aaâ‚ğ–†ğ—®ğ˜¢ğ™–ğšŠğ›‚ğœ¶ğª]\s?[MĞœâ…¯ğ•„ğ”ğ— ğ™ˆğ™¢ğ™¼ğš–][aaâ‚ğ–†ğ—®ğ˜¢ğ™–ğšŠğ›‚ğœ¶ğª][Ñ•sğ‘†ğ’”ğ“¢ğ”°ğ•Šğ•Šğ–˜ğ–˜ğ—¦ğ˜´ğ™ğš‚][kğ‘˜ğ’Œğ”ğ•œğ•œğ—ğ˜¬ğ™†ğ™‰ğ™ ]')
  )
  and not sender.email.domain.domain in ("metamask.io", "zendesk.com", "discoursemail.com")
  and any(body.links,
    any([beta.linkanalysis(.)],
      .effective_url.domain.root_domain not in $alexa_1m
      or .original_url.domain.root_domain in $alexa_1m
      or .effective_url.domain.tld in $suspicious_tlds
      or .original_url.domain.domain in $url_shorteners
    )
  )
tags:
  - "Brand impersonation"
  - "Phishing"
  - "Suspicious link"
