name: "Attachment: W-9 and invoice documents with Chromium creator metadata"
description: "Detects messages containing multiple attachments including a W-9 form and invoice-related documents where at least one attachment has EXIF creator metadata indicating it was generated by Chromium. This pattern may indicate automated document generation or conversion used in business email compromise attacks targeting financial processes."
type: "rule"
severity: "high"
source: |
  type.inbound
  and length(attachments) >= 2
  and any(
      attachments, 
      //
      // This rule makes use of a beta feature and is subject to change without notice
      // using the beta feature in custom rules is not suggested until it has been formally released
      //
      beta.parse_exif(.).creator == "Chromium"
  )
  and length(filter(attachments, 
      strings.icontains(.file_name, "W9")
      or strings.icontains(.file_name, "w-9"))
  ) == 1
  and length(filter(attachments, 
      strings.istarts_with(.file_name, "bill")
      or strings.istarts_with(.file_name, "lnv")
      or strings.istarts_with(.file_name, "inv")
      or regex.contains(.file_name, '^(\d{3}|\w{1})[A-Z0-9]+(.pdf)'))
  ) >= 1
  

attack_types:
  - "BEC/Fraud"
tactics_and_techniques:
  - "Evasion"
  - "Social engineering"
detection_methods:
  - "File analysis"
  - "Exif analysis"
