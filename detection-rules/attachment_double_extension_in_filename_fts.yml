name: "Attachment: Double File Extension in Filename (first time sender)"
description: |
  Attachment with double file extension in file name from first time sender.
type: "query"
source: |
  type.inbound
  and any(map(attachments, .file_name), regex.contains(., '(\.[a-z]{3,4}){2}$'))
  and (
    (
      sender.email.domain.root_domain in $free_email_providers
      and sender.email.email not in $sender_emails
    )
    or (
      sender.email.domain.root_domain not in $free_email_providers
      and sender.email.domain.domain not in $sender_domains
    )
  )
severity: "low"
tags:
  - "Double file extension"
  - "Suspicious attachment"
