name: "Link: Credential theft with subject starting with org name and display text"
description: "Detects messages with short body content where the subject line begins with an organization name followed by link display text, combined with high-confidence credential theft language indicators."
type: "rule"
severity: "medium"
source: |
  type.inbound
  // short body
  and regex.count(body.current_thread.text, '\S+') < 100 
  // subject base starts with org name + link display_text
  and any(
          // the distinct diplay_text of links in the current thread
          distinct(map(filter(body.current_thread.links, .display_text is not null), .display_text)
          ),
          any(distinct(map(filter(ml.nlu_classifier(body.current_thread.text).entities,
                                  .name == "org"
                           ),
                           .text
                       )
              ),
              strings.istarts_with(subject.base, strings.concat(., ' ', ..))
          )
  )
  // cred_theft high intent on the body
  and any(ml.nlu_classifier(body.current_thread.text).intents,
          .name == "cred_theft" and .confidence == "high"
  )

attack_types:
  - "Credential Phishing"
tactics_and_techniques:
  - "Impersonation: Brand"
  - "Social engineering"
detection_methods:
  - "Content analysis"
  - "Natural Language Understanding"
id: "a5fd1365-f97c-5151-b483-e0e21876d299"
