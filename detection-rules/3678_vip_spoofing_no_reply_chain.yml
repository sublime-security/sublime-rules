name: "VIP spoofing: Contact information in body without reply chain"
description: "Detects messages containing VIP contact information (name and email address) in the body content without proper email thread references, indicating potential impersonation of organizational VIPs."
type: "rule"
severity: "high"
source: |
  type.inbound
  and not (
    sender.email.domain.root_domain not in $high_trust_sender_root_domains
    and coalesce(headers.auth_summary.dmarc.pass, false)
  )
  and (length(headers.references) > 0 or not headers.in_reply_to is null)
  // org_vip as recipient in previous thread
  and any(body.previous_threads, any($org_vips, ..sender.email.email == .email))
  // org_vip as sender of previous thread
  and any(body.previous_threads, any($org_vips, .email == ..sender.email.email))
  // no longer in the message
  and not any(recipients.to, any($org_vips, .email == ..email.email))
tags:
  - "Attack surface reduction"
attack_types:
  - "BEC/Fraud"
tactics_and_techniques:
  - "Impersonation: VIP"
  - "Social engineering"
detection_methods:
  - "Content analysis"
  - "Header analysis"
id: "8fbef841-cf5e-5539-8212-a1ecf0b4a874"
og_id: "736d71cc-7415-55da-b13c-05fa4d027f9c"
testing_pr: 3678
testing_sha: fbf9f8f020a8ed12b73a8dde07cdb190600cd075