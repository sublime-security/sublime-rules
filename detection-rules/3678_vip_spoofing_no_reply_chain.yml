name: "VIP spoofing: Contact information in body without reply chain"
description: "Detects messages containing VIP contact information (name and email address) in the body content without proper email thread references, indicating potential impersonation of organizational VIPs."
type: "rule"
severity: "high"
source: |
  type.inbound
  and (length(headers.references) == 0 or headers.in_reply_to is null)
  and any($org_vips,
          1 of (
              strings.icontains(body.html.raw,
                  strings.concat(.display_name, " <")
              ),
              strings.icontains(body.html.raw,
                  strings.concat("<", .email, ">")
              ),
              strings.icontains(body.current_thread.text,
                  strings.concat(.display_name, " <")
              ),
              strings.icontains(body.current_thread.text,
                  strings.concat("<", .email, ">")
              ),
              strings.icontains(body.plain.raw,
                  strings.concat(.display_name, " <")
              ),
              strings.icontains(body.plain.raw,
                  strings.concat("<", .email, ">")
              ),
          )
  )
tags:
  - "Attack surface reduction"
attack_types:
  - "BEC/Fraud"
tactics_and_techniques:
  - "Impersonation: VIP"
  - "Social engineering"
detection_methods:
  - "Content analysis"
  - "Header analysis"
id: "8fbef841-cf5e-5539-8212-a1ecf0b4a874"
og_id: "736d71cc-7415-55da-b13c-05fa4d027f9c"
testing_pr: 3678
testing_sha: 2f8d15376b2f5ff87c0a913249adacda26e31998