name: "PR# 3896 - Attachment: MSG file with VBA macros"
description: "Detects MSG file attachments containing VBA macros with medium to high risk indicators. MSG files with attachments containing embedded macros can be used to deliver malicious code while appearing as legitimate Outlook message files."
type: "rule"
severity: "high"
source: |
  type.inbound
  and length(attachments) > 0
  and any(attachments,
          .file_extension =~ "msg"
          and file.oletools(.).indicators.vba_macros.exists
          and file.oletools(.).indicators.vba_macros.risk in ("medium", "high")
  )

attack_types:
  - "Malware/Ransomware"
tactics_and_techniques:
  - "Evasion"
  - "Macros"
detection_methods:
  - "File analysis"
  - "Macro analysis"
  - "OLE analysis"
id: "9aec759d-e6f5-5fd1-97c0-b5426087e759"
tags:
  - created_from_open_prs
  - rule_status_added
  - pr_author_peterdj45
references:
  - https://github.com/sublime-security/sublime-rules/pull/3896