name: "Fake shipping notification from Chinese sender domain"
description: "Detects messages from senders using Alibaba (HiChina) hosting services that contain shipping, customer service, or order confirmation topics."
type: "rule"
severity: "medium"
source: |
  type.inbound
  // direct to recipient
  and length(recipients.to) == 1
  and length(body.previous_threads) == 0
  
  // Known patterns
  and (sender.display_name is null or sender.email.local_part == "support")
  and all(headers.reply_to, .email.domain.root_domain == sender.email.domain.root_domain)
  
  // Alibaba Cloud nameservers
  and length(network.whois(sender.email.domain).name_servers) > 0
  and all(network.whois(sender.email.domain).name_servers,
          .root_domain == "hichina.com"
  )
  
  // Shipping notification
  and any(ml.nlu_classifier(body.current_thread.text).topics,
          .name in ('Shipping and Package', "Order Confirmations")
  )
attack_types:
  - "BEC/Fraud"
  - "Credential Phishing"
tactics_and_techniques:
  - "Social engineering"
detection_methods:
  - "Content analysis"
  - "Natural Language Understanding"
  - "Sender analysis"
  - "Whois"
id: "f06895ee-8225-5929-a02a-bc86de15b278"
og_id: "4392a14e-421e-5e2f-8659-a92d1a6bb1fd"
testing_pr: 3607
testing_sha: a19af211cd8dc4b4332b822c479dfa8e8290ec11