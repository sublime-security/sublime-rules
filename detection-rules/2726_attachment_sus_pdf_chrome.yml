name: "Attachment: Suspicious PDF Created With Headless Browser"
description: "Detects PDF documents containing a table of contents that were generated using HeadlessChrome, Chromium with Skia/PDF, or QT with empty metadata fields - common characteristics of automated malicious document creation."
type: "rule"
severity: "high"
source: |
  type.inbound
  and any(filter(attachments, .file_type == "pdf"),
          any(file.explode(.),
              strings.contains(.scan.ocr.raw, 'TABLE OF CONTENTS')
          )
          // the action Table of contents can be on another page
          and any(file.explode(.),
                  regex.icontains(.scan.ocr.raw, '[\r\n]+1\s*(\.|:)\s*Introduction')
          )
          and (
            (
              (
                strings.icontains(beta.parse_exif(.).creator, 'HeadlessChrome')
                or strings.icontains(beta.parse_exif(.).creator, 'Chromium')
              )
              and strings.icontains(beta.parse_exif(.).producer, 'Skia/PDF')
            )
            or (
              any(beta.parse_exif(.).fields, .key == "Creator" and .value == "")
              and any(beta.parse_exif(.).fields, .key == "Title" and .value == "")
              and strings.istarts_with(beta.parse_exif(.).producer, 'QT ')
            )
          )
  )
attack_types:
  - "Credential Phishing"
tactics_and_techniques:
  - "Evasion"
  - "PDF"
detection_methods:
  - "Content analysis"
  - "Exif analysis"
  - "File analysis"
  - "Optical Character Recognition"
id: "22170c73-5485-5995-22d0-744db4b99390"
og_id: "8f3108d7-e224-5bb0-81f4-e4f8506cfed3"
testing_pr: 2726
testing_sha: 2937a1d53190b5adf1a17a393aedd79f2a6ac307
