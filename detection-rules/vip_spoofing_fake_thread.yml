name: "VIP spoofing: Fake quoted message format"
description: "Detects messages that reference VIP names or email addresses in quoted message format without being actual replies, potentially indicating impersonation through fabricated conversation threads."
type: "rule"
severity: "high"
source: |
  type.inbound
  and (length(headers.references) == 0 or headers.in_reply_to is null)
  and any($org_vips,
          1 of (
            strings.icontains(body.html.raw, strings.concat(.display_name, " <")),
            strings.icontains(body.html.raw, strings.concat("<", .email, ">")),
            strings.icontains(body.current_thread.text,
                              strings.concat(.display_name, " <")
            ),
            strings.icontains(body.current_thread.text,
                              strings.concat("<", .email, ">")
            ),
            strings.icontains(body.plain.raw, strings.concat(.display_name, " <")),
            strings.icontains(body.plain.raw, strings.concat("<", .email, ">")),
          )
  )
tags:
  - "Attack surface reduction"
attack_types:
  - "BEC/Fraud"
tactics_and_techniques:
  - "Impersonation: VIP"
  - "Social engineering"
  - "Evasion"
detection_methods:
  - "Content analysis"
  - "Header analysis"