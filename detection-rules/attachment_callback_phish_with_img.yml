name: "Attachment: Callback Phishing solicitation via image file"
description: "A fraudulent invoice/receipt found in an image attachment.\nCallback Phishing is an attempt by an attacker to solicit the victim (recipient) to call a phone number. \nThe resulting interaction could lead to a multitude of attacks ranging from Financial theft, Remote Access Trojan (RAT) Installation or Ransomware Deployment.\n"
type: "rule"
authors:
  - twitter: "vector_sec"
severity: "high"
source: "type.inbound\nand (\n  not profile.by_sender().solicited\n  or (\n    profile.by_sender().any_messages_malicious_or_spam\n    and not profile.by_sender().any_false_positives\n  )\n)\nand (\n  sender.email.domain.root_domain in $free_email_providers\n  or sender.email.domain.root_domain in (\"onmicrosoft.com\")\n  or (\n    (\n      length(recipients.to) == 0\n      or all(recipients.to, .display_name == \"Undisclosed recipients\")\n    )\n    and length(recipients.cc) == 0\n    and length(recipients.bcc) == 0\n  )\n)\nand any(attachments,\n        // exclude images taken with mobile cameras and screenshots from android\n        .file_type in $file_types_images\n        and (\n          any(file.explode(.),\n              not any(.scan.exiftool.fields,\n                      .key == \"Model\"\n                      or (\n                        .key == \"Software\"\n                        and strings.starts_with(.value, \"Android\")\n                      )\n              )\n              // exclude images taken with mobile cameras and screenshots from Apple\n              and not any(.scan.exiftool.fields,\n                          .key == \"DeviceManufacturer\"\n                          and .value == \"Apple Computer Inc.\"\n              )\n              and not any(.scan.exiftool.fields,\n                          .key == \"UserComment\" and .value == \"Screenshot\"\n              )\n              // 4 of the following strings are found        \n              and 4 of (\n                // this section is synced with attachment_callback_phish_with_pdf.yml and body_callback_phishing_no_attachment.yml\n                strings.icontains(.scan.ocr.raw, \"purchase\"),\n                strings.icontains(.scan.ocr.raw, \"payment\"),\n                strings.icontains(.scan.ocr.raw, \"transaction\"),\n                strings.icontains(.scan.ocr.raw, \"subscription\"),\n                strings.icontains(.scan.ocr.raw, \"antivirus\"),\n                strings.icontains(.scan.ocr.raw, \"order\"),\n                strings.icontains(.scan.ocr.raw, \"support\"),\n                strings.icontains(.scan.ocr.raw, \"help line\"),\n                strings.icontains(.scan.ocr.raw, \"receipt\"),\n                strings.icontains(.scan.ocr.raw, \"invoice\"),\n                strings.icontains(.scan.ocr.raw, \"call\"),\n                strings.icontains(.scan.ocr.raw, \"helpdesk\"),\n                strings.icontains(.scan.ocr.raw, \"cancel\"),\n                strings.icontains(.scan.ocr.raw, \"renew\"),\n                strings.icontains(.scan.ocr.raw, \"refund\"),\n                strings.icontains(.scan.ocr.raw, \"contact us at\"),\n                strings.icontains(.scan.ocr.raw, \"+1\"),\n                strings.icontains(.scan.ocr.raw, \"amount\"),\n                strings.icontains(.scan.ocr.raw, \"charged\"),\n                strings.icontains(.scan.ocr.raw, \"crypto\"),\n                strings.icontains(.scan.ocr.raw, \"wallet address\"),\n                regex.icontains(.scan.ocr.raw, '\\$\\d{3}\\.\\d{2}\\b'),\n                regex.icontains(.scan.ocr.raw,\n                                '\\+?([ilo0-9]{1}.)?\\(?[ilo0-9]{3}?\\)?.[ilo0-9]{3}.?[ilo0-9]{4}'\n                ),\n                regex.icontains(.scan.ocr.raw,\n                                '\\+?([ilo0-9]{1,2})?\\s?\\(?\\d{3}\\)?[\\s\\.\\-⋅]{0,5}[ilo0-9]{3}[\\s\\.\\-⋅]{0,5}[ilo0-9]{4}'\n                ),\n                strings.icontains(.scan.ocr.raw, \"+1\")\n              )\n              // this section is synced with attachment_callback_phish_with_pdf.yml and body_callback_phishing_no_attachment.yml\n              and regex.icontains(.scan.ocr.raw,\n                                  '(p.{0,3}a.{0,3}y.{0,3}p.{0,3}a.{0,3}l|ma?c.?fee|n[o0]rt[o0]n|geek.{0,5}squad|ebay|symantec|best buy|lifel[o0]c|secure anywhere|starz|utilities premium|pc security|at&t)'\n              )\n          )\n          // this section is synced with attachment_callback_phish_with_pdf.yml and body_callback_phishing_no_attachment.yml\n          or any(ml.logo_detect(.).brands,\n                 .name in (\n                   \"PayPal\",\n                   \"Norton\",\n                   \"GeekSquad\",\n                   \"Ebay\",\n                   \"McAfee\",\n                   \"AT&T\"\n                 )\n          )\n        )\n)\n"
attack_types:
  - "Callback Phishing"
tactics_and_techniques:
  - "Evasion"
  - "Free email provider"
  - "Out of band pivot"
  - "Social engineering"
  - "Image as content"
detection_methods:
  - "Content analysis"
  - "Optical Character Recognition"
  - "Sender analysis"
  - "URL analysis"
  - "Computer Vision"
id: "60acbb36-8ed1-562e-8027-260c2fdf0f04"
testing_pr: 2418
testing_sha: c0629980262d81b8e03eb7b99ac12b827453ec00
