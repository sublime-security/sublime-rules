name: "Attachment: Base64 encoded bash command in filename"
description: "This rule detects a fileless attack technique where a malicious payload is encoded directly into a filename. This technique, used by threats like VShell. The rule is designed to find these malicious filenames both in direct attachments and within archived files (like .zip, .rar, etc.)."
authors:
  - twitter: "vector_sec"
type: rule
severity: high
source: |
  type.inbound
  and length(attachments) > 0
  and any(attachments,
          (
            .file_type in $file_extensions_common_archives
            or strings.contains(.file_name, "{")
          )
          and any(beta.expand_archives(.).files,
                  strings.contains(.file_name, "{")
                  and any(beta.scan_base64(.file_name), length(.) > 1)
          )
  )
attack_types:
  - "Malware/Ransomware"
tactics_and_techniques:
  - "Encryption"
  - "Evasion"
  - "Suspicious Attachment"
detection_methods:
  - "Archive analysis"
  - "File analysis"
  - "Content analysis"
id: "0fb1974d-8fd6-556b-a352-d3c43e1259b1"
references:
- https://www.trellix.com/blogs/research/the-silent-fileless-threat-of-vshell/
og_id: "819f69c8-91c2-5261-8c13-d177c46bff66"
testing_pr: 3113
testing_sha: 5002b3c72a22f9f236c1cbf80a982274dcd80a66