name: "Spam: Promotion/giveaway with urgency and exclusivity language"
description: "Detects promotional spam messages containing links with high-confidence advertising/promotional content, multiple urgency indicators, organizational references, and exclusivity language such as 'been selected', 'congratulations', 'exclusive', or 'free kit' from senders that are either untrusted or have failed DMARC authentication."
type: "rule"
severity: "low"
source: |
  type.inbound
  and length(body.links) > 0
  and any(ml.nlu_classifier(body.current_thread.text).topics,
          .name == "Advertising and Promotions" and .confidence == "high"
  )
  and length(filter(ml.nlu_classifier(body.current_thread.text).entities,
                    .name == "urgency"
             )
  ) > 2
  and length(filter(ml.nlu_classifier(body.current_thread.text).entities,
                    .name == "org"
             )
  ) > 0
  and 2 of (
    length(distinct(body.links, .href_url.url)) == 1,
    strings.icontains(body.current_thread.text, "been selected"),
    strings.icontains(body.current_thread.text, "congratulations"),
    strings.icontains(body.current_thread.text, "exclusive"),
    strings.icontains(subject.subject, "free"),
    regex.icontains(body.current_thread.text, 'free.{0,25}kit')
  )
  // negate highly trusted sender domains unless they fail DMARC authentication
  and (
    (
      sender.email.domain.root_domain in $high_trust_sender_root_domains
      and not headers.auth_summary.dmarc.pass
    )
    or sender.email.domain.root_domain not in $high_trust_sender_root_domains
  )
tags:
 - "Attack surface reduction"
attack_types:
  - "BEC/Fraud"
  - "Spam"
tactics_and_techniques:
  - "Social engineering"
detection_methods:
  - "Content analysis"
  - "Header analysis"
  - "Natural Language Understanding"
  - "Sender analysis"
  - "URL analysis"
