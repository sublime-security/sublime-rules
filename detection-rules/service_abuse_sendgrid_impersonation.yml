name: "Service abuse: SendGrid impersonation via Sendgrid from first-time sender"
description: "Detects messages impersonating SendGrid from senders that have not been seen before, while routing through legitimate SendGrid infrastructure. This pattern is commonly used to abuse trusted email services for malicious purposes."
type: "rule"
severity: "high"
source: |
  type.inbound
  and strings.icontains(strings.replace_confusables(sender.display_name), 'sendgrid')
  and profile.by_sender_email().prevalence == "new"
  and any(headers.domains, strings.icontains(.domain, 'outbound-mail.sendgrid.net'))

attack_types:
  - "Credential Phishing"
tactics_and_techniques:
  - "Impersonation: Brand"
  - "Social engineering"
detection_methods:
  - "Header analysis"
  - "Sender analysis"
