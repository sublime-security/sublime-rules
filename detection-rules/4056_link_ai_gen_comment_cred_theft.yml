name: "PR# 4056 - Link: AI-generated credential theft with HTML comments"
description: "Detects messages containing AI-generated HTML comments with phrases like 'as requested' or 'replace link', combined with styled button elements and credential theft language."
type: "rule"
severity: "medium"
source: |
  type.inbound
  and length(body.previous_threads) == 0
  // contains ai-esque code comments like "as requested" and "replace x link"
  and any(html.xpath(body.html, '//comment()').nodes,
          regex.icontains(.raw,
                          'keeping.{0,10}same|as.{0,10}requested|replace.{0,20}(?:url|link|below)|\(unchanged\)|<!-- new:|<!-- replace|Header with Logo'
          )
  )
  // contains a button
  and any(html.xpath(body.html, '//a[@style]').nodes,
          regex.icontains(.raw, 'padding') and regex.icontains(.raw, 'background')
  )
  and any(ml.nlu_classifier(body.current_thread.text).intents,
          .name in ("cred_theft") and .confidence != "low"
  )
  and not sender.email.domain.root_domain in $high_trust_sender_root_domains
tags:
  - "Attack surface reduction"
  - pr_author_IndiaAce
  - created_from_open_prs
  - rule_status_added
attack_types:
  - "Credential Phishing"
tactics_and_techniques:
  - "Evasion"
  - "Social engineering"
detection_methods:
  - "HTML analysis"
  - "Natural Language Understanding"
  - "Content analysis"
id: "2c14f782-fd01-58aa-a99d-936a34d61d07"
references:
  - https://github.com/sublime-security/sublime-rules/pull/4056