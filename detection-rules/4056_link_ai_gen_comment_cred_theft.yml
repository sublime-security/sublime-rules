name: "Link: AI-generated credential theft with HTML comments"
description: "Detects messages containing AI-generated HTML comments with phrases like 'as requested' or 'replace link', combined with styled button elements and credential theft language."
type: "rule"
severity: "medium"
source: |
  type.inbound
  and length(body.previous_threads) == 0
  // contains ai-esque code comments like "as requested" and "replace x link"
  and any(html.xpath(body.html, '//comment()').nodes,
          regex.icontains(.raw,
                          'keeping.{0,10}same|as.{0,10}requested|replace.{0,30}(?:url|link|below|available|need|want)|\(unchanged\)|Header with Logo'
          )
  )
  // contains a button
  and any(html.xpath(body.html, '//a[@style]').nodes,
          regex.icontains(.raw, 'padding') and regex.icontains(.raw, 'background')
  )
  and any(ml.nlu_classifier(body.current_thread.text).intents,
          .name in ("cred_theft") and .confidence != "low"
  )
  and not sender.email.domain.root_domain in $high_trust_sender_root_domains
tags:
  - "Attack surface reduction"
attack_types:
  - "Credential Phishing"
tactics_and_techniques:
  - "Evasion"
  - "Social engineering"
detection_methods:
  - "HTML analysis"
  - "Natural Language Understanding"
  - "Content analysis"
id: "2c14f782-fd01-58aa-a99d-936a34d61d07"
og_id: "1d8e2743-0053-5e0b-a025-141bb8207d85"
testing_pr: 4056
testing_sha: c836ae3a4e9c171f1de366973aaffd5e0720dc45