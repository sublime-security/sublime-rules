name: "PR# 3787 - Link: Fake payment notification PDF with suspicious hosting"
description: "Detects messages containing payment notification language (ACH, wire, EFT) with links that appear to be PDF files but actually redirect to self-service platforms or free file hosts. The rule identifies financial-themed link text combined with BEC intent, payment request topics, or suspicious financial subdomain patterns."
type: "rule"
severity: "high"
source: |
  type.inbound
  // At least 1 link and less than 10
  and 1 <= length(body.links) < 10
  
  // PDF-named link to self-service platform
  and any(body.current_thread.links,
          // Link display text looks like a PDF file
          strings.iends_with(.display_text, ".pdf")
          // But the URL goes to a self-service platform (not an actual PDF)
          and (
            .href_url.domain.root_domain in $self_service_creation_platform_domains
            or .href_url.domain.domain in $self_service_creation_platform_domains
            or .href_url.domain.root_domain in $free_file_hosts
            or .href_url.domain.domain in $free_file_hosts
          )
          // Link text contains financial keywords
          and (
            strings.icontains(.display_text, "payment")
            or strings.icontains(.display_text, "remit")
            or strings.icontains(.display_text, "invoice")
            or strings.icontains(.display_text, "report")
            or strings.icontains(.display_text, "receipt")
            or strings.icontains(.display_text, "statement")
          )
  )
  
  // Additional suspicious indicators (any one)
  and (
    // High confidence for payment request
    any(ml.nlu_classifier(body.current_thread.text).topics,
        .name == "Payment Information" and .confidence == "high"
    )
    // Or suspicious subdomain pattern (financial-themed)
    or any(body.current_thread.links,
           regex.icontains(.href_url.domain.subdomain,
                           'account|payable|payment|invoice|billing'
           )
    )
  )
  
  // False positive reduction
  and not sender.email.domain.root_domain in $org_domains
attack_types:
  - "BEC/Fraud"
tactics_and_techniques:
  - "Free file host"
  - "PDF"
  - "Social engineering"
  - "Evasion"
detection_methods:
  - "Content analysis"
  - "Natural Language Understanding"
  - "Sender analysis"
  - "URL analysis"
id: "b1f8c425-7c67-5380-aafa-f9529c2f9c07"
tags:
  - created_from_open_prs
  - rule_status_added
  - pr_author_MSAdministrator
references:
  - https://github.com/sublime-security/sublime-rules/pull/3787