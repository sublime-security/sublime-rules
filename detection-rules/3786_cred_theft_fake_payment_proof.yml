name: "Credential theft with fake payment proof language"
description: "Detects messages containing generic greetings to 'user' or 'customer' combined with payment proof keywords in the subject or body. The message contains credential theft language with medium to high confidence from natural language processing analysis. Excludes legitimate payment processors that pass authentication."
type: "rule"
severity: "medium"
source: |
  type.inbound
  // non descript greeting to "user" or "customer"
  and regex.icontains(body.current_thread.text,
                      'dear.{0,10}(?:user|customer)[,\r\n]'
  )
  // payment proof keywords in subject or suspicious indicators in the body
  and (
    regex.icontains(subject.subject,
                    'proof.{0,10}payment|payment.{0,10}proof|payment.{0,10}reference|reference.{0,10}payment'
    )
    or regex.icontains(body.current_thread.text,
                       'please find.{0,20}payment|payment.{0,10}proof|payment.{0,10}reference|reference.{0,10}payment|attached.{0,10}proof|kindly'
    )
  )
  // NLU thinks credential theft intent
  and any(ml.nlu_classifier(body.current_thread.text).intents,
          .name == "cred_theft" and .confidence in ("medium", "high")
  )
  
  // exclude legitimate payment processors and financial institutions who pass auth
  and not (
    sender.email.domain.root_domain in (
      "paypal.com",
      "stripe.com",
      "square.com",
      "adyen.com",
      "worldpay.com",
      "authorize.net"
    )
    and headers.auth_summary.dmarc.pass
  )
attack_types:
  - "Credential Phishing"
tactics_and_techniques:
  - "Social engineering"
  - "Impersonation: Brand"
detection_methods:
  - "Content analysis"
  - "Header analysis"
  - "Natural Language Understanding"
  - "Sender analysis"
id: "337fd5ff-8cb0-5635-8895-b8193602015a"
og_id: "b8b75627-d5a2-54b7-99ac-86e548da7b26"
testing_pr: 3786
testing_sha: d131557f472d20f980c65ecc4594808f66cbe173