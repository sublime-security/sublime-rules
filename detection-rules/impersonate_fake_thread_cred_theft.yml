name: "VIP impersonation in fake thread with credential theft"
description: "Detects fake message threads impersonating VIP personnel with credential theft language or suspicious technical requests. The rule identifies messages that appear to be replies or forwards but lack proper threading headers, while containing VIP names and malicious content designed to steal credentials or execute unauthorized commands."
type: "rule"
severity: "high"
source: |
  type.inbound
  // fake thread
  and (
    (subject.is_forward or subject.is_reply or length(body.previous_threads) > 0)
    and (length(headers.references) == 0 or headers.in_reply_to is null)
  )
  // impersonated VIP in fake thread
  and (
    any(body.previous_threads,
        any($org_vips, .display_name == ..sender.display_name)
    )
    or any($org_vips, strings.icontains(body.plain.raw, .display_name))
  )
  // NLU cred theft
  and (
    any(ml.nlu_classifier(body.plain.raw).intents,
        .name == "cred_theft" and .confidence != "low"
    )
    // or suspicious reqeusts like "install" or "terminal" with urgency factor
    or (
      any(ml.nlu_classifier(body.plain.raw).entities,
          .name == "request"
          and regex.icontains(.text, ('terminal|command|curl|install'))
      )
      and any(ml.nlu_classifier(body.plain.raw).entities, .name == "urgency")
    )
  )
  

attack_types:
  - "BEC/Fraud"
  - "Credential Phishing"
tactics_and_techniques:
  - "Impersonation: VIP"
  - "Social engineering"
  - "Evasion"
detection_methods:
  - "Content analysis"
  - "Header analysis"
  - "Natural Language Understanding"
  - "Sender analysis"
id: "535b95ba-e0c0-5cb2-acaf-bb9dccae9caa"
