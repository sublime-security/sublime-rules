name: "Attachment: Office365 image"
description: |
  Looks for messages with an image attachment that contains words related to Microsoft, Office365, and passwords.
type: "rule"
severity: "medium"
authors:
  - twitter: "vector_sec"
source: |
  type.inbound
  and length(body.html.inner_text) < 300
  and any(attachments, .file_extension in~ ('bmp','png','jpg','jpeg')
      and any(file.explode(.),
          (
              (
                  any(.scan.strings.strings, strings.ilike(., "*password*", "*microsoft*")) and
                  any(.scan.strings.strings, strings.ilike(.,  "*expire*", "*expiry*","*office365*", "*office*"))
              )
          or
              (
                  strings.ilike(.scan.ocr.raw, "*microsoft*", "*password*") and
                  strings.ilike(.scan.ocr.raw,  "*office365*", "*office*", "*expire*", "*expiry*")
              )
          )
      )
  )
tags:
  - "Suspicious attachment"
