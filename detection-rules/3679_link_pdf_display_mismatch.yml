name: "Link: PDF display mismatch with business document social engineering"
description: "Detects links that display as PDF files but actually point to HTML pages on low-reputation domains, combined with business proposal or document-related social engineering language in the subject or body from external senders."
type: "rule"
severity: "high"
source: |
  type.inbound

  // Core PDF display mismatch pattern
  and any(body.current_thread.links,
          // Link displays as PDF but points to HTML page
          strings.ilike(.display_text, "*.pdf")
          // Link domain is not reputable  
          and .href_url.domain.root_domain not in $tranco_1m
          // Domain completely unrelated to sender's organization
          and .href_url.domain.root_domain != sender.email.domain.root_domain
  )
  
  // Business document context
  and (
    // Look for business proposal/document language
    strings.ilike(body.current_thread.text,
                  "*proposal*",
                  "*RFP*",
                  "*selected*",
                  "*architects*",
    )
    or strings.ilike(subject.base,
                     "*proposal*",
                     "*RFP*",
                     "*document*",
                     "*architects*"
    )
  )
  
  // Not from organizational domains
  and not (
    sender.email.domain.root_domain in $org_domains
    and coalesce(headers.auth_summary.dmarc.pass, false)
  )
  
  // Not legitimate document sharing services
  and not any(body.current_thread.links,
              strings.ilike(.display_text, "*.pdf")
              and .href_url.domain.root_domain in (
                "dropbox.com",
                "onedrive.live.com",
                "drive.google.com"
              )
  )
attack_types:
  - "Credential Phishing"
  - "BEC/Fraud"
  - "Malware/Ransomware"
tactics_and_techniques:
  - "Evasion"
  - "Social engineering"
detection_methods:
  - "Content analysis"
  - "Sender analysis"
  - "URL analysis"
  - "Whois"
id: "813c4820-6d55-5c33-8ee0-86d6de9c042f"
og_id: "901c1dd0-d557-57cf-b520-a287ad6e8be7"
testing_pr: 3679
testing_sha: ddbb4a45ef69e7b632e2069ef4c15716af6d65af