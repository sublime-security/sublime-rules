name: "Attachment: 7z Archive Containing RAR File"
description: "Detects 7z archive attachments that contain RAR files, which may be used to evade detection by nesting compressed file formats."
type: "rule"
severity: "medium"
source: |
    type.inbound
    and any(attachments,
            (
              .file_extension in~ $file_extensions_common_archives
              and  .file_type == "7z"
            )
            and any(file.expand_archives(.).files, .file_type == "rar")        
    )
tags:
 - "Attack surface reduction"
attack_types:
  - "Malware/Ransomware"
tactics_and_techniques:
  - "Evasion"
detection_methods:
  - "Archive analysis"
  - "File analysis"
id: "b2445026-585a-545e-815b-5b279401b270"
og_id: "1a629bb4-931a-5395-bf22-da327d224d3c"
testing_pr: 3471
testing_sha: d6e5a2e139f222d78931fc7ac7f2813410c20be0