name: "Link: Tycoon2FA phishing kit with suspicious domain indicators (non-exhaustive)"
description: "Detects links utilizing the Tycoon2FA phishing kit, identified by specific DOM structure patterns and CDN characteristics, combined with suspicious domain indicators such as free subdomain hosts or suspicious TLDs. As the Tycoon2FA kit is evolving, this rule will not detect all varients of Tycoon2FA phishing, and is designed to compliment existing and future detections."
type: "rule"
severity: "high"
source: |
  type.inbound
  and length(body.links) < 10
  and any(body.links,
          // initial suspicious link check
          (
            .href_url.domain.root_domain in $free_subdomain_hosts
            or .href_url.domain.tld in $suspicious_tlds
            or any(recipients.to,
                   strings.icontains(..href_url.url, .email.email)
                   and .email.domain.valid
            )
          )
  
          // known Tycoon pattern (benign on its own, but a good confirming indicator when coupled with additional logic)
          and any(ml.link_analysis(.).unique_urls_accessed,
                  .path in ("/cdn-cgi/rum")
          )
  
          // Tycoon2FA "CAPTCHA"
          and length(distinct(map(html.xpath(ml.link_analysis(.).final_dom,
                                             '//*/@class'
                                  ).nodes,
                                  .raw
                              ),
                              .
                     )
          ) == 5
          and all(distinct(map(html.xpath(ml.link_analysis(.).final_dom,
                                          '//*/@class'
                               ).nodes,
                               .raw
                           ),
                           .
                  ),
                  . in ("card", "title", "hint", "grid", "dot")
          )
  )

attack_types:
  - "Credential Phishing"
tactics_and_techniques:
  - "Free subdomain host"
  - "Evasion"
  - "Credential Phishing"
detection_methods:
  - "URL analysis"
  - "HTML analysis"
  - "Content analysis"
