name: "Service abuse: Google application integration redirecting to suspicious hosts"
description: "Detects legitimate Google application integration emails that contain links redirecting to free file hosting services or free subdomain hosts, including Microsoft OAuth redirects to suspicious domains. These could indicate abuse of Google's legitimate service for malicious redirects."
type: "rule"
severity: "medium"
source: |
  type.inbound
  and sender.email.email == "noreply-application-integration@google.com"
  and headers.auth_summary.dmarc.pass
  and any(body.links,
          .href_url.domain.domain in $free_file_hosts
          or .href_url.domain.domain in $free_subdomain_hosts
          or (
            .href_url.domain.domain == "login.microsoftonline.com"
            and (
              strings.parse_url(.href_url.query_params_decoded['redirect_uri'][0]).domain.root_domain in $free_file_hosts
              or strings.parse_url(.href_url.query_params_decoded['redirect_uri'][0]
              ).domain.root_domain in $free_subdomain_hosts
            )
          )
  )
tags:
  - "Attack surface reduction"
attack_types:
  - "Credential Phishing"
  - "Malware/Ransomware"
tactics_and_techniques:
  - "Evasion"
  - "Free file host"
  - "Free subdomain host"
  - "Open redirect"
detection_methods:
  - "Header analysis"
  - "Sender analysis"
  - "URL analysis"
