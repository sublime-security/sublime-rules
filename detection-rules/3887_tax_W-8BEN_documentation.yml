name: "PR# 3887 - Tax Form: W-8BEN solicitation"
description: "Detects messages containing references to W-8BEN tax forms, commonly used in tax-related fraud schemes targeting individuals and businesses."
type: "rule"
severity: "medium"
source: |
  type.inbound
  and (
    (
      // few links
      0 < length(body.links) < 20
      and any(body.links, network.whois(.href_url.domain).days_old <= 30)
      or any(body.links, network.whois(.href_url.domain).days_old <= 60)
      // fewer unique root domain links
      and length(distinct(body.links, .href_url.domain.root_domain)) < 10
      // sender domain matches no body domains
      and all(body.links,
              .href_url.domain.root_domain != sender.email.domain.root_domain
      )
    )
  )
  and (
    regex.icontains(subject.subject, ".*Foreign Tax*")
    or regex.icontains(subject.subject, ".*W-8BEN*")
  )
  and any([body.current_thread.text],
          regex.icontains(.,
                          'tax form',
                          'W-8BEN',
                          'tax return',
                          'tax preparation',
                          'tax documentation',
                          'regulatory',
                          'withholding',
                          'approve',
                          'non-US tax',
                          'treaty',
                          'Official Documentation Update System',
                          'Renew Documentation',
                          'Secure link',
                          'Update',
                          'Dear Client'
          )
  )
  
  // Suspicious link patterns
  and any(body.links,
          not .href_url.domain.root_domain in $high_trust_sender_root_domains
  )
  
  // negate highly trusted sender domains unless they fail DMARC authentication
  and (
    (
      sender.email.domain.root_domain in $high_trust_sender_root_domains
      and not headers.auth_summary.dmarc.pass
    )
    or sender.email.domain.root_domain not in $high_trust_sender_root_domains
  )
attack_types:
  - "BEC/Fraud"
  - "Credential Phishing"
tactics_and_techniques:
  - "Social engineering"
detection_methods:
  - "Content analysis"
  - "Header analysis"
  - "URL analysis"
id: "fda606ef-d217-56e0-a7fd-ddfa1d4fa06d"
tags:
  - created_from_open_prs
  - rule_status_added
  - pr_author_cybher0808
references:
  - https://github.com/sublime-security/sublime-rules/pull/3887