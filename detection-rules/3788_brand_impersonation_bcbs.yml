name: "Brand impersonation: Blue Cross Blue Shield with suspicious indicators"
description: "Detects messages impersonating Blue Cross Blue Shield brands from suspicious senders. It flags messages from domains younger than one year or older domains with authentication failures, suspicious links, or other risk indicators."
type: "rule"
severity: "medium"
source: |
  type.inbound
  and regex.icontains(body.current_thread.text,
                      '\bbluecross\b',
                      '\bblue cross\b',
                      '\bblueshield\b',
                      '\bblue shield\b',
                      '\bbcbs\b'
  )
  and (
    regex.icontains(body.current_thread.text, '\bkit\b', '\bpackage\b')
    or (
      regex.icontains(body.current_thread.text, 'review.{0,8}document')
      and any(ml.nlu_classifier(body.current_thread.text).intents,
              .name == "cred_theft" and .confidence == 'high'
      )
    )
  )
  and 1 <= length(body.links) <= 9
  
  // negate legitimate BCBS root domains
  // can be expanded as needed
  and not sender.email.domain.root_domain in (
    'bcbs.com', // universal domain
    'fepblue.org', // federal employee domain
    'anthembluecross.com', // anthem affiliate domain
    // global domains
    'bcbsglobal.com', // universal global domain
    'bcbsglobalsolutions.com', // universal global domain
    'geo-blue.com', // merged universal global domain
    'bcbspma.com', // panama domain
    'bcbsu.com', // uruguay domain
    // canada
    'bluecross.ca', // canadian domain
    'medaviebc.ca', // medavie domain
    'ontarioblue.ca', // ontario domain
    // us domains
    'bcbsal.org', // alabama domain
    'premera.com', // alaska domain
    'azblue.com', // arizona domain
    'arkansasbluecross.com', // arkansas domain
    'arkbluecross.com', // arkansas redirected shortened mail domain
    'antheminc.com', // california domain
    'blueshieldca.com', // california domain
    'anthem.com', // CO, CT, IN, KY, ME, MO, NV, NH, OH, VA, WI domain
    'highmarkbcbsde.com', // DE domain
    'carefirst.com', // DC, MD, VA domain
    'bcbsfl.com', // florida domain
    'floridablue.com', // florida domain
    'bcbsga.com', // georgia domain
    'hmsa.com', // hawaii domain
    'bcidaho.com', // idaho domain
    'regence.com', // ID, OR, UT, WA domain
    'bcbsil.com', // illinois domain
    'wellmark.com', // IA, SD domain
    'bcbsks.com', // kansas domain
    'bcbsla.com', // louisiana domain
    'bcbsma.com', // massachusetts domain
    'bluecrossma.com', // massachusetts domain
    'bcbsm.com', // michigan domain
    'bluecrossmn.com', // minnesota domain
    'bcbsms.com', // mississippi domain
    'bluekc.com', // missouri domain
    'bcbsmt.com', // montana domain
    'nebraskablue.com', // nebraska domain
    'horizonblue.com', // new jersey domain
    'bcbsnm.com', // new mexico domain
    'empireblue.com', // new york domain
    'bcbswny.com', // new york domain
    'bsneny.com', // new york domain
    'excellusbcbs.com', // new york domain
    'bcbsnc.com', // north carolina domain
    'bcbsnd.com', // north dakota domain
    'bcbsok.com', // oklahoma domain
    'capbluecross.com', // pennsylvania domain
    'highmarkblueshield.com', // PA, WV domain
    'highmarkbcbs.com', // pennsylvania domain
    'ibx.com', // pennsylvania domain
    'ssspr.com', // puerto rico domain
    'bcbsri.com', // rhode island domain
    'bcbssc.com', // south carolina domain
    'southcarolinablues.com', // south carolina domain
    'bcbst.com', // tennessee domain
    'bcbstx.com', // texas domain
    'bluecrossvt.org', // vermont domain
    'bcbswy.com', // wyoming domain
  )
  // negate highly trusted sender domains unless they fail DMARC authentication
  and (
    (
      sender.email.domain.root_domain in $high_trust_sender_root_domains
      and not headers.auth_summary.dmarc.pass
    )
    or sender.email.domain.root_domain not in $high_trust_sender_root_domains
  )
  // negate org domains unless they fail DMARC authentication
  and (
    (
      sender.email.domain.root_domain in $org_domains
      and not headers.auth_summary.dmarc.pass
    )
    or sender.email.domain.root_domain not in $org_domains
  )
  // negate legitimate conversations
  and not (
    (subject.is_forward or subject.is_reply) and headers.in_reply_to is not null
  )
  // topic negations
  and not any(ml.nlu_classifier(body.current_thread.text).topics,
              .name in ("Events and Webinars")
  )
  // younger domain
  and (
    network.whois(sender.email.domain).days_old <= 365
    // older domain with conditions
    or (
      network.whois(sender.email.domain).days_old >= 365
      // sketchy sender
      and (
        not headers.auth_summary.dmarc.pass
        or not headers.auth_summary.spf.pass
        or any(distinct(headers.hops, .authentication_results.dkim is null),
               strings.ilike(.authentication_results.dkim, "*fail")
        )
        or any(headers.reply_to, network.whois(.email.domain).days_old < 30)
        or sender.email.domain.root_domain in $free_email_providers
        or (
          all(recipients.to, .email.email == sender.email.email)
          and length(recipients.cc) == 0
          and length(recipients.bcc) == 0
        )
        // sketchy content
        or (
          any(body.links,
              network.whois(.href_url.domain).days_old < 30
              or .href_url.domain.domain in $url_shorteners
          )
        )
        // links don't match sender
        or all(body.links,
               .href_url.domain.root_domain != sender.email.domain.root_domain
               and not (
                 .href_url.domain.root_domain == "mimecastprotect.com"
                 and strings.parse_domain(.href_url.query_params_decoded["domain"][0]
                 ).root_domain == sender.email.domain.root_domain
               )
        )
      )
    )
  )

attack_types:
  - "Credential Phishing"
  - "Spam"
tactics_and_techniques:
  - "Impersonation: Brand"
  - "Social engineering"
detection_methods:
  - "Content analysis"
  - "Natural Language Understanding"
  - "Header analysis"
  - "Sender analysis"
  - "URL analysis"
  - "Whois"
id: "7022235d-50a1-5475-ba98-c5cd7326e2b1"
og_id: "07c472f6-6b1f-5de0-9bfb-0ae61fe53ab0"
testing_pr: 3788
testing_sha: 16474bdbaf1912d07d8970fe38dea1851bbb1482