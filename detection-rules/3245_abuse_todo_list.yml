name: "Service abuse: Task management message sent via SendGrid"
description: "Detects messages impersonating task or productivity applications by using 'todo list' or 'reminder list' in the subject line while utilizing SendGrid infrastructure. The sender claims to be task-related through display name or body content but originates from non-legitimate domains without proper DMARC authentication."
type: "rule"
severity: "high"
source: |
  type.inbound
  //subject contains "todo list"
  and (
    regex.icontains(subject.subject, "T[0o] D[o0] L[I1l]ST")
    or (
      strings.icontains(subject.subject, "todo")
      and strings.icontains(subject.subject, "list")
    )
    or (
      strings.icontains(subject.subject, "reminder")
      and strings.icontains(subject.subject, "list")
    )
  )
  // utilizing sendgrid infra
  and strings.icontains(headers.return_path.domain.root_domain, "sendgrid")
  and (
    // and sender claims to be task/productivity related but domain doesn't match
    (
      regex.icontains(headers.from.display_name, "(task|todo|gtask|reminder)")
      or regex.icontains(body.current_thread.text,
                         "(waiting for review|new task.*added|[0-9]+ of [0-9]+ tasks? completed)"
      )
    )
    // not from legitimate or internal domains (unless DMARC fails)
    and not (
      sender.email.domain.root_domain in $org_domains
      and headers.auth_summary.dmarc.pass
    )
  )

attack_types:
  - "Credential Phishing"
tactics_and_techniques:
  - "Impersonation: Brand"
  - "Social engineering"
  - "Evasion"
detection_methods:
  - "Content analysis"
  - "Header analysis"
  - "Sender analysis"
id: "4f3ed61b-06b1-5b1b-8f12-deedc2c8ee94"
og_id: "568a63f5-dbd2-5f9a-a84a-b4d8aa49c59b"
testing_pr: 3245
testing_sha: 38bc9cfc49787cf63110fc7a028415105bf5a5f7