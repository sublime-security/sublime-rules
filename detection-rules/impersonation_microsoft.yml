name: "Brand impersonation: Microsoft"
description: |
    Impersonation of the Microsoft brand.
references:
    - "https://www.itproportal.com/news/cybercriminals-launch-targeted-phishing-attacks-against-microsoft-365-users/"
    - "https://cofense.com/blog/office-365-phishing-variant/"
    - "https://www.helpnetsecurity.com/2020/05/04/fake-microsoft-teams-notification/"
type: "rule"
severity: "high"
source: |
  type.inbound
  and (
    (
      ilike(subject.subject, '*Microsoft 365*') 
      and ilike(subject.subject, '*is expired*')
    )
    or iregex_search(body.html.raw, ".*reply in teams.*", ".*reach.*you.*microsoft.*teams.*", ".*install microsoft teams.*")
    or ilike(sender.display_name, '*new activity in Teams*')
    or subject.subject =~ 'Offline Message in Teams'
    or ilike(subject.subject, '*Teams Sent A Message')
    or sender.display_name in~ ('Microsoft Partner Network','Microsoft',
                               'Microsoft Feedback', 'Microsoft account team',
                               'Microsoft Support', 'Microsoft Outlook', 
                               'Microsoft 365 Message center', 
                               'Microsoft Azure')
  )                                                                                                                                                                          
  and sender.email.domain.root_domain != 'microsoft.com'
tags:
  - "Brand impersonation"
  - "Suspicious sender"
