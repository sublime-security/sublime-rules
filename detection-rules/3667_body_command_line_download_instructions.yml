name: "Body: Command-line download and execution instructions"
description: "Detects messages containing PowerShell commands or system utilities (curl, wget, certutil, etc.) followed by domain names, which may indicate malicious script execution or file download instructions."
type: "rule"
severity: "high"
source: |
  type.inbound
  and regex.icontains(body.current_thread.text,
                      '\b(powershell|pwsh|curl|wget|bitsadmin|certutil|mshta|wscript|cscript|rundll32|regsvr32|msiexec|ftp|tftp|invoke-webrequest|invoke-restmethod|start-bitstransfer|invoke-expression)\b.{0,50}?([a-z0-9-]+\.)+[a-z]{2,}'
  )
tags:
 - "Attack surface reduction"
attack_types:
  - "Malware/Ransomware"
tactics_and_techniques:
  - "Scripting"
  - "Social engineering"
detection_methods:
  - "Content analysis"
id: "2170332f-ba8d-5d03-adda-8d7fb5917474"
og_id: "dabb343b-1848-5150-b3cf-f5bced6afdb5"
testing_pr: 3667
testing_sha: ea8e84d9cd52810847e84caa28da43cc3b6776d8