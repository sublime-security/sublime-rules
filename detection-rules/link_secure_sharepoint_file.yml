name: "Link: Secure SharePoint File Shared from New or Unsual Sender"
description: "This ASR rule detections the use of Secure SharePoint links which require recipiant verifcation before allowing access to the shared file.  This has been observed being used as a method of evading automated analysis of the shared files' content. "
type: "rule"
severity: "low"
source: |
  type.inbound
  // SharePoint email indicators
  and strings.icontains(body.plain.raw, "shared a file with you")
  // the Sharepoint file has been "Protected"
  and not strings.icontains(body.plain.raw,
                            "This link only works for the direct recipients of this message"
  )
  and any(body.links, .href_url.domain.root_domain == "sharepoint.com")
  
  // sender is uncommon
  and profile.by_sender().prevalence in ("new", "rare", "outlier")
  and not profile.by_sender().solicited
tags:
 - "Attack surface reduction"
attack_types:
  - "Credential Phishing"
tactics_and_techniques:
  - "Free file host"
  - "Evasion"
detection_methods:
  - "Content analysis"
  - "Sender analysis"
