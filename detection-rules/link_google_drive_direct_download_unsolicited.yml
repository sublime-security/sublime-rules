name: "Google Drive direct download link from unsolicited sender"
description: |
  This rule detects Google Drive links that use the direct download URL pattern which automatically downloads files when clicked. This pattern is frequently used by threat actors to distribute malware.

  The links are formatted like: drive.google.com/uc?id=FILE_ID&export=download

  These links skip the preview page and immediately download the file to the user's device, which can be dangerous for recipients. Threat actors exploit this pattern to directly distribute malware while appearing to share legitimate content from a trusted service.
type: "rule"
severity: "medium"
source: "type.inbound\nand 0 < length(body.links) < 10\nand any(body.links,\n        (\n          // Match Google Drive direct download links\n          strings.icontains(.href_url.url, \"drive.google.com/uc\") \n          and (\n            strings.icontains(.href_url.url, \"export=download\")\n            or strings.icontains(.href_url.query_params, \"export=download\")\n          )\n        )\n)\n// negate highly trusted sender domains unless they fail DMARC authentication\nand (\n  (\n    sender.email.domain.root_domain in $high_trust_sender_root_domains\n    and not headers.auth_summary.dmarc.pass\n  )\n  or sender.email.domain.root_domain not in $high_trust_sender_root_domains\n)\nand (\n  // Only trigger on unsolicited senders\n  not profile.by_sender().solicited\n  or (\n    // Or senders with suspicious history\n    profile.by_sender().any_messages_malicious_or_spam\n    and not profile.by_sender().any_false_positives\n  )\n)\n"
tags:
  - "Attack surface reduction"
attack_types:
  - "Malware/Ransomware"
  - "Credential Phishing"
tactics_and_techniques:
  - "Evasion"
  - "Social engineering"
  - "Free file host"
detection_methods:
  - "URL analysis"
  - "Sender analysis"
  - "Content analysis"
id: "78a19343-cfe7-5fd5-9816-dcb4293b705d"
testing_pr: 2453
testing_sha: 1bf18a0bc718a004bf823fa11c5928ed8734235f
