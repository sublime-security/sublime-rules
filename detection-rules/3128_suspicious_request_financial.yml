name: "Suspicious request for financial information"
description: "Email is from a suspicious sender and contains a request for financial information, such as AR reports."
type: "rule"
severity: "high"
source: |
  type.inbound
  // no attachments
  and length(attachments) <= 1
  // direct to recipient
  and length(recipients.to) <= 2
  // suspicious sender
  and (
    (
      length(headers.reply_to) > 0
      and all(headers.reply_to,
              .email.domain.root_domain != sender.email.domain.root_domain
              and .email.domain.root_domain not in $org_domains
      )
    )
    or sender.email.domain.root_domain in $free_email_providers
    or profile.by_sender().days_known < 3
  )
  // specific financial language
  and (
    regex.icontains(subject.subject,
                    '\b(Aged|Age?ing) (Payables|Receivables|Report)'
    )
    or (
      regex.icontains(body.current_thread.text,
                      '\b(Aged|Age?ing) (Payables|Receivables|Report)',
                      '(updated|recent) (\bAR\b|\b\AP\b|\bAR\b \& \bAP\b|accounts?) (Payables|Receivables|Reports)'
      )
      or strings.icontains(body.current_thread.text,
                           "copy of a current statement"
      )
      or (
        strings.icontains(body.current_thread.text, "please send all past due")
        and strings.icontains(body.current_thread.text, "current invoices")
      )
    )
  )
  // negate resume related/job inquiry outreach 
  and not (
    any(ml.nlu_classifier(body.current_thread.text).topics,
        .name == "Professional and Career Development" and .confidence == "high"
    )
    and any(ml.nlu_classifier(body.current_thread.text).intents,
            .name == "benign" and .confidence != "low"
    )
  )
  and (
    (
      sender.email.domain.root_domain in $high_trust_sender_root_domains
      and not headers.auth_summary.dmarc.pass
    )
    or sender.email.domain.root_domain not in $high_trust_sender_root_domains
  )
  and not profile.by_sender().any_messages_benign

attack_types:
  - "BEC/Fraud"
tactics_and_techniques:
  - "Free email provider"
  - "Impersonation: Employee"
  - "Impersonation: VIP"
  - "Social engineering"
detection_methods:
  - "Content analysis"
  - "Header analysis"
  - "Sender analysis"
id: "487af071-6bb0-501a-94d1-46423d3bdb21"
og_id: "4ebdaa4d-4db2-56c6-9a6c-220ad49b7681"
testing_pr: 3128
testing_sha: 3032320f352bdaa16bde85ee1354953e6b85b147