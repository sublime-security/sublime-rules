name: "Non-RFC compliant calendar files from unsolicited sender"
description: "Detects calendar (.ics) files that do not follow RFC standards by lacking required UID identifiers while containing specific calendar components (VTODO, VJOURNAL, VFREEBUSY, or VEVENT). Forged ICS calendar invites can be spoofed to seemingly originate from any sender."
type: "rule"
severity: "medium"
references:
  - "https://mrd0x.com/spoofing-calendar-invites-using-ics-files/"
source: |
  type.inbound
  and any(attachments,
          (
            .file_extension in $file_extensions_common_archives
            or .file_extension == "ics"
            or .content_type == "text/calendar"
          )
          and any(file.explode(.),
                  (.file_extension == "ics" or .flavors.mime == "text/calendar")
                  and any(.scan.ics.calendars,
                          any(.components,
                              .uid is null
                              and .type in (
                                'VEVENT',
                                'VJOURNAL',
                                'VFREEBUSY',
                                'VTODO'
                              )
                          )
                  )
          )
  )
tags:
 - "Attack surface reduction"
tactics_and_techniques:
  - "Evasion"
  - "Social engineering"
detection_methods:
  - "Archive analysis"
  - "Content analysis"
  - "File analysis"
  - "Sender analysis"
id: "62ffb0a4-73fa-550d-9296-35d379e0faca"
og_id: "9859f100-5fa5-5bb5-9ca6-bce8925afe6d"
testing_pr: 4031
testing_sha: c85ea521f3ba65891fda9b05cffceb8af0b792d6