name: "PR# 3743 - Spam: Conference or summit invitation"
description: "Detects invites for conferences or summits that request speaking, presenting, or sponsorship opportunities. The rule looks for invitation language combined with event-related terms and presentation requests, while excluding legitimate calendar invites and conversations."
type: "rule"
severity: "low"
source: |
  type.inbound
  // invitation (1 required)
  and (
    strings.icontains(body.current_thread.text, "attend")
    or strings.icontains(body.current_thread.text, "relevant fit")
    or strings.icontains(body.current_thread.text, "your chance")
    or strings.icontains(body.current_thread.text, "you're invited")
    or strings.icontains(body.current_thread.text, "invitation code")
    or strings.icontains(body.current_thread.text, "promo code")
    or strings.icontains(body.current_thread.text, "early bird")
    or regex.icontains(body.current_thread.text,
                       '\bjoin (?:us|them?)\b',
                       'dear.{0,15}colleagues?',
                       '(?:opportunity|contribute) to',
                       '\bparticipat(?:e|ion)\b',
                       'collaborat(?:e|ion)',
                       '\bnominat(?:ed?|ions?)\b',
                       '\bpartner(?:ing|ship)?s?\b',
                       '(?:\blook|looking\b) forward to.{0,15}your?',
                       '(?:regist(?:er|ration)|submission) deadline',
                       'invit(?:e|ing|ation)(?: you| them| to)?',
                       'miss (?:this|the) chance'
    )
    or (
      regex.icontains(body.current_thread.text, '\bapply\b')
      and not regex.icontains(body.current_thread.text,
                              '\bterms (?:and|&) conditions\b'
      )
    )
  )
  
  // request (1 required)
  and (
    strings.icontains(body.current_thread.text, "pitch")
    or strings.icontains(body.current_thread.text, "sponsor")
    or regex.icontains(body.current_thread.text,
                       '\bpresent(?:ing|ation)?\b',
                       '\bspeak(?:er|ers)?(?: at)?\b'
    )
  )
  
  // event (1 required)
  and (
    regex.icontains(body.current_thread.text,
                    '\bpanel\b',
                    '\bforum\b',
                    '\bsummit\b'
    )
    or (
      strings.icontains(body.current_thread.text, "conference")
      and not regex.icontains(body.current_thread.text, '\bconference call\b')
    )
  )
  
  // topic negations
  and not any(ml.nlu_classifier(body.current_thread.text).topics,
              .name in (
                "Newsletters and Digests",
                "Charity and Non-Profit",
                "Reminders and Notifications",
                "Government Services"
              )
  )
  
  // keyword negations
  and not (
    (
      strings.ilike(body.current_thread.text,
                    "*internship*",
                    "*scholarship*",
                    "*chamber?of?commerce*",
                    "*invoice?number*",
                    "*payment?details*",
                    "*balance?due*"
      )
      or regex.icontains(body.current_thread.text, '\bpay\b.{0,10}invoice')
    )
    and not strings.icontains(body.current_thread.text, "complimentary")
  )
  
  // negate legit invites
  and not any(attachments,
              (.file_extension =~ "ics" or .content_type == "text/calendar")
  )
  and not (
    any(body.links, .href_url.domain.root_domain == 'zoom.us')
    and strings.ilike(body.current_thread.text, '*meeting id:*')
    and strings.ilike(body.current_thread.text, '*passcode:*', '*password:*')
  )
  
  // negate important tld's
  and not (
    sender.email.domain.tld in ('gov', 'edu') and headers.auth_summary.dmarc.pass
  )
  
  // negate highly trusted sender domains unless they fail DMARC authentication
  and (
    (
      sender.email.domain.root_domain in $high_trust_sender_root_domains
      and not headers.auth_summary.dmarc.pass
    )
    or sender.email.domain.root_domain not in $high_trust_sender_root_domains
  )
  
  // negate org domains unless they fail DMARC authentication
  and (
    (
      sender.email.domain.root_domain in $org_domains
      and not headers.auth_summary.dmarc.pass
    )
    or sender.email.domain.root_domain not in $org_domains
  )
  
  // negate legitimate conversations
  and not (
    (subject.is_reply or subject.is_forward)
    and (
      length(headers.references) > 0
      and any(headers.hops, any(.fields, strings.ilike(.name, "In-Reply-To")))
    )
  )

attack_types:
  - "Spam"
tactics_and_techniques:
  - "Social engineering"
detection_methods:
  - "Content analysis"
  - "Header analysis"
  - "Sender analysis"
id: "0e9606f8-8261-5acd-96cf-d6cb5898a593"
tags:
  - created_from_open_prs
  - rule_status_added
  - pr_author_missingn0pe
references:
  - https://github.com/sublime-security/sublime-rules/pull/3743