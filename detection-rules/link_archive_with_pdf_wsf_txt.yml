name: "Link: Archive with pdf, txt and wsf files"
description: |
  Detects a known Qakbot delivery method, zip file with pdf, txt and wsf file at a depth of 1.
references:
  - "https://delivr.to/payloads?id=0d152c7b-9a80-443f-b45e-fedd85493f0e"
type: "rule"
severity: "medium"
source: |
  type.inbound 
  and any(body.links, 
      any(beta.linkanalysis(.).files_downloaded,
          .file_extension in~ $file_extensions_common_archives
          and length(distinct(filter(file.explode(.), .depth == 1
          and .flavors.mime in~ ("application/pdf", "text/plain")), .flavors.mime)) == 2
          and any(file.explode(.), .depth == 1 and .file_extension == "wsf")
      )
  )
tags: 
  - "Qakbot"
  - "Suspicious link"