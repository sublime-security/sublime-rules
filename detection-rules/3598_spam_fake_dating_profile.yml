name: "Spam: Fake dating profile notification"
description: "Detects dating-themed messages from free email providers containing links with the recipient's email address embedded in URL parameters, combined with suspicious language or topics in the message body."
type: "rule"
severity: "low"
source: |
  type.inbound
  and sender.email.domain.root_domain in $free_email_providers
  // not a reply
  and length(headers.references) == 0
  and 0 < length(filter(distinct(body.links, .href_url.domain.root_domain),
                        .href_url.domain.root_domain not in ("aka.ms")
                 )
  ) <= 3
  and (
    any(body.links,
        any(.href_url.query_params_decoded["email"],
            strings.parse_email(.).email in map(recipients.to, .email.email)
        )
    )
  )
  and (
    any(ml.nlu_classifier(body.current_thread.text).entities,
        .name == "org"
        and strings.ilike(.text, "*Date*", "*Dating*", "*Girls*", "*Love*")
    )
    or any(ml.nlu_classifier(body.current_thread.text).topics, .name == "Romance")
  )

attack_types:
  - "Spam"
tactics_and_techniques:
  - "Free email provider"
  - "Social engineering"
detection_methods:
  - "Content analysis"
  - "Header analysis"
  - "Natural Language Understanding"
  - "Sender analysis"
  - "URL analysis"
id: "1c32bd6d-3d1f-533d-8213-a63b8c08fef0"
og_id: "0f33fea2-1508-5ae8-a31b-9d498dfcadba"
testing_pr: 3598
testing_sha: 22a36d0f6eb70b43d51d994f086551cebe0dcf87