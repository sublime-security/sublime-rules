name: "Brand impersonation: Coinbase with suspicious link"
description: "This rule detects Coinbase phishing emails with suspicious links"
type: "rule"
severity: "medium"
source: |
  type.inbound
  and sender.email.domain.root_domain != "coinbase.com"
  and (
    (
      any(["coinbase", "coin base"], strings.icontains(coalesce(body.html.display_text, body.plain.raw), .))
      or regex.icontains(coalesce(sender.display_name, subject.subject),
        '\b[Câ’¸â“’ğ‘ªğ’ğ“¬ğ” ğ•”ğ•¥ğ–ˆğ–”ğ–™ğ—Œğ—°ğ˜Šğ˜¤ğ™¤ğšŒğ°][oâ‚’â“ğ‘œğ’ğ“¸ğ• ğ–”ğ—¼ğ˜ğ™¤ğš˜ğ¸][iğ¼ğ‘–ğ’Šğ“²ğ•šğ–ğ—œğ˜ªğ™„ğš’][nâ“ƒğ‘›ğ’ğ“·ğ”«ğ•Ÿğ–“ğ™£ğš—]\s?[Bâ’·â“‘ğ‘©ğ’ƒğ“«ğ”Ÿğ•“ğ•¥ğ—•][aaâ‚ğ–†ğ—®ğ˜¢ğ™–ğšŠğ›‚ğœ¶ğª][sğ‘†ğ’”ğ“¢ğ”°ğ•Šğ•Šğ–˜ğ–˜ğ—¦ğ˜´ğ™ğš‚][eğ‘’ğ’†ğ“”ğ”¢ğ•–ğ•–ğ–Šğ–Šğ—²ğ™€ğšğ´ğ®]\b')
    )
  )
  and all(body.links,
    .href_url.domain.root_domain != "coinbase.com"
    and (
      any(beta.binexplode(beta.linkanalysis(.).screenshot),
        all([
          "Coinbase",
          "recovery",
          "phrase"
        ], strings.icontains(..scan.ocr.raw, .))
      )
      or .href_url.domain.root_domain in $free_subdomain_hosts
    )
  )
tags:
  - "Brand impersonation"
  - "Suspicious link"
