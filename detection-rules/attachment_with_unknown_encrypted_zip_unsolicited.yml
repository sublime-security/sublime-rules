name: "Attachment with unscannable encrypted zip (unsolicited)"
description: |
  Recursively scans files and archives to detect embedded ZIP files
  that are encrypted and could not be opened/scanned.
references:
  - "https://www.zdnet.com/article/this-phishing-email-contains-a-password-protected-file-dont-open-it/"
type: "rule"
source: |
  type.inbound
  and any(attachments,
        any(beta.binexplode(.),
        any(.flavors.yara, . == 'encrypted_zip') and .scan.encrypted_zip.cracked_password == null)
  )
  and sender.email.email not in $recipient_emails
tags:
  - "Suspicious attachment"
