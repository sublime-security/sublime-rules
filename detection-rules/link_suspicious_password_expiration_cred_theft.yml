name: "Link: Suspicious Password expiration credential theft"
description: |
  This rule detects suspicious emails with a moderate number of links (between 1 and 10) that reference password expiration in the body. The rule also considers links that are null routed
  or have a very short body with links to free subdomain hosts, indicating potentially suspicious activity.
type: "rule"
severity: "medium"
source: |
  type.inbound
  and 0 < length(body.links) < 10 
  and strings.ilike(body.html.display_text, "*expir*")
  and strings.ilike(body.html.display_text, "*password*")
  and any(ml.nlu_classifier(body.html.display_text).intents, .name == "cred_theft")
  and 
      (
          any(body.links, .display_url.url is not null
          and .display_url.url != .href_url.url
          and .href_url.url == "#"
      or
          length(body.html.inner_text) < 300
          and .href_url.domain.root_domain in $free_subdomain_hosts
          and .href_url.domain.subdomain is not null
          and .href_url.domain.subdomain != "www")
      )
  
tags: 
  - "Credential phishing"
  - "Suspicious Link"
  - "Natural Language Understanding"
id: "bda9e0b1-526d-52e4-8091-a5b9e9c11598"
