name: "Attachment: PDF with suspicious HeadlessChrome metadata"
description: "Detects PDF attachments created by HeadlessChrome with suspicious characteristics, including MD5-formatted HTML filenames or blank titles with Windows Skia/PDF producer, excluding legitimate Google Docs files."
type: "rule"
severity: "medium"
source: |
  type.inbound
  and any(filter(attachments, .file_extension == "pdf"),
          strings.icontains(beta.parse_exif(.).creator, "HeadlessChrome")
          and (
            // MD5 filename, 32 hex chars and .html
            regex.imatch(beta.parse_exif(.).title, '^[a-f0-9]{32}\.html$')
            or 
            // about:blank and Windows HeadlessChrome 
            (
              beta.parse_exif(.).title == "about:blank"
              and strings.istarts_with(beta.parse_exif(.).producer, "Skia/PDF")
              and strings.icontains(beta.parse_exif(.).creator, "Windows")
            )
          )
          and not strings.icontains(beta.parse_exif(.).producer, "Google Docs")
  )

attack_types:
  - "Credential Phishing"
  - "Malware/Ransomware"
tactics_and_techniques:
  - "Evasion"
  - "PDF"
detection_methods:
  - "File analysis"
  - "Exif analysis"
id: "43e3fe31-d02c-553c-830a-2152e7f227cb"
og_id: "eda99b1d-5639-57a0-860e-2d55b7f3b84f"
testing_pr: 3660
testing_sha: baf874274ab10ba703c3a1c91e653811a65e997c