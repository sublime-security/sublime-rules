name: "Service Abuse: QuickBooks Notification with Suspicious Comments"
description: "This detection rule matches QuickBooks notifications that contain suspicious keywords within the comments section of the notification"
type: "rule"
severity: "medium"
source: "type.inbound\n\n// Legitimate Intuit sending infratructure\nand sender.email.email == \"quickbooks@notification.intuit.com\"\n\n// remove payment confirmation messages\nand not strings.starts_with(subject.subject, 'Payment confirmation:')\n\nand body.html.raw is not null\n// Comments contains suspicious phrases\nand (\n  // several different templates where commonly observed, run regex for each template\n  any([\n        html.xpath(body.html,\n                   '//span[@id=\"condensedEmailMessageSectionContentWebPlayer\"]'\n        ).nodes,\n        html.xpath(body.html, '//div[@id=\"emailContainer\"]').nodes,\n        html.xpath(body.html, '//table[@width=\"700\"][1]//tr/td').nodes,\n        html.xpath(body.html, '//tr[@class=\"email-header\"]').nodes,\n        html.xpath(body.html, '//tr[@class=\"email-center\"]').nodes,\n        html.xpath(body.html, '//div[@class=\"mlr22\"]').nodes,\n        html.xpath(body.html, '//td[@class=\"itemDesc\"]//div').nodes,\n        html.xpath(body.html, '//td[@class=\"shippingContent\"]//div').nodes\n      ],\n      any(.,\n          regex.icontains(.inner_text,\n                          // subscription, renewals, verificaitons, etc\n                          '(?:your subscription renewal|couldn.?t be processed|trouble renewing subscription|update your details|just update your|continue your subscription|prefer to use EFT|change payment method|verify your account|suspended due to issue|payment declined notice|account needs verification|confirm your billing|immediate action required|failed payment notification|billing information update|service interruption warning|unable to process payment|subscription payment failed|action needed now|update banking information|subscription expiration notice|payment method change)', \n                          // callback wording\n                          'recognize this seller?|For more info.{0,25}Call|To cancel.{0,25}Call|did not authorize',\n          )\n      )\n  )\n) \n"
attack_types:
  - "Callback Phishing"
  - "Credential Phishing"
  - "BEC/Fraud"
tactics_and_techniques:
  - "Evasion"
  - "Social engineering"
detection_methods:
  - "Content analysis"
  - "Sender analysis"
  - "Header analysis"
id: "e5568652-46a7-5c03-7bfc-ce760dc39030"
og_id: "a23d0950-9117-5199-bc74-7192217b80ff"
testing_pr: 2852
testing_sha: 44bf10b14321d9fe116f75fcd3f03e05c9800022
