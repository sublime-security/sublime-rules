name: "PR# 3867 - Headers: Self-addressed message with empty body"
description: "Detects messages where the sender address matches the recipient address or the recipient has an invalid domain, with an empty plain text body. This pattern is commonly used to bypass security filters or test mail routing configurations."
type: "rule"
severity: "medium"
source: |
  type.inbound
  and length(recipients.to) == 1
  and length(recipients.cc) == 0
  and length(recipients.bcc) == 0
  and (
    sender.email.email == recipients.to[0].email.email
    or recipients.to[0].email.domain.valid == false
  )
  and length(body.plain.raw) == 0

attack_types:
  - "BEC/Fraud"
  - "Spam"
tactics_and_techniques:
  - "Evasion"
  - "Spoofing"
detection_methods:
  - "Header analysis"
  - "Sender analysis"
  - "Content analysis"
id: "22570b15-8030-5b05-88cc-59a4baf03840"
tags:
  - created_from_open_prs
  - rule_status_added
  - pr_author_markmsublime
references:
  - https://github.com/sublime-security/sublime-rules/pull/3867