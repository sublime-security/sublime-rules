name: "Link: Single Mural link with suspicious indicators"
description: "Message contains use of Mural's platform but the sender is not Mural, with suspicious file sharing language or document sharing indicators in the subject or body."
type: "rule"
severity: "medium"
source: |
  type.inbound
  // contains a link to mural.co
  and any(body.links, .href_url.domain.domain == "app.mural.co")
  // a single mural link 
  and length(distinct(filter(body.links,
                             .href_url.domain.domain == "app.mural.co"
                             and strings.istarts_with(.href_url.path, '/t/')
                      ),
                      .href_url.url
             )
  ) == 1
  // sus indicators
  and (
    any(beta.ml_topic(body.current_thread.text).topics,
        .name == "File Sharing and Cloud Services" and .confidence == "high"
    )
    // sus keywords in the subject/current_thread
    or any([subject.subject, body.current_thread.text],
           strings.icontains(., "Proposal")
           or regex.icontains(., '(?:shared|sent)\s*(?:\s*\w*){0,5}\s*document')
    )
  )
  
  // not from mural 
  and not (
    sender.email.domain.domain == "muralapp.co"
    and headers.auth_summary.dmarc.pass
  )

attack_types:
  - "Credential Phishing"
tactics_and_techniques:
  - "Social engineering"
detection_methods:
  - "Content analysis"
  - "URL analysis"
  - "Sender analysis"
  - "Header analysis"
id: "54f2b48c-0f1e-5ffb-9731-e1617d00558e"
og_id: "03456c9e-c1d9-5d55-a60d-279be30739f2"
testing_pr: 2845
testing_sha: 57f0b9e1e238a2f9851cdaa290a4c112291106d1