name: "Attachment: PDF with structured URL paths and social engineering keywords"
description: "Detects PDF attachments containing URLs with ULID/UUID patterns in /app/ structures combined with social engineering keywords like 'SECURE', 'REVIEW', or 'ACCESS' from suspicious senders. The URLs target non-legitimate file sharing domains and end with action-oriented endpoints."
type: "rule"
severity: "high"
source: |
  type.inbound

  // ULID or UUID v7 in path with /app/ structure
  and any(filter(attachments, .file_extension == "pdf"),
          any(file.explode(.),
              any(.scan.url.urls,
                  // ULID pattern (26 chars)
                  regex.imatch(.path,
                               '^/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/app/[\w?a-fA-F0-9-]+/(?:latest|view|access)$'
                  )
                  // Contains social engineering keywords in path
                  and regex.icontains(.path,
                                      'DOCUMENT|SECURE|REVIEW|SHARED|FILE|VIEW|ACCESS|MESSAGE'
                  )
                  // Ends with version/action endpoint
                  and regex.imatch(.path,
                                   '.*/(?:latest|current|view|access|open|v[0-9]+)$'
                  )
                  // Not legitimate file sharing services
                  and not .domain.root_domain in $free_file_hosts
              )
          )
  )
attack_types:
  - "Credential Phishing"
  - "BEC/Fraud"
tactics_and_techniques:
  - "PDF"
  - "Social engineering"
  - "Evasion"
detection_methods:
  - "Archive analysis"
  - "File analysis"
  - "Sender analysis"
  - "URL analysis"
id: "0b8e7164-2184-54ef-ad2a-39760720effb"
