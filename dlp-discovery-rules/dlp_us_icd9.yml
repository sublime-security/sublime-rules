name: "DLP: US ICD-9-CM Code"
description: "Detects messages containing ICD-9-CM diagnosis and procedure codes."
type: "dlp"
severity: "medium"
source: |
  type.outbound
  and any([body.current_thread.text, subject.subject],
          // ICD-9 diagnosis: 3-5 chars, starts with digit or E/V
          // ICD-9 procedure: 3-4 digits only
          regex.contains(., '\b(?:[EVev]?\d{3}\.?\d{0,2}|\d{3,4})\b')
  )
  and any([body.current_thread.text, subject.subject],
          regex.icontains(., 'ICD-?9|diagnosis\s+code|procedure\s+code')
  )

detection_methods:
  - "Content analysis"
