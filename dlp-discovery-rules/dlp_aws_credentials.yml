name: "DLP: AWS Credentials"
description: "Detects messages containing AWS access keys and secret keys."
type: "rule"
severity: "high"
source: |
  type.outbound
  and any([body.current_thread.text, subject.subject],
          // AWS Access Key ID: AKIA followed by 16 alphanumeric characters
          regex.contains(., '\bAKIA[0-9A-Z]{16}\b')
  )
  and (
    any([body.current_thread.text, subject.subject],
            regex.icontains(., 'aws|amazon|access\s+key|secret\s+key')
    )
    or any([body.current_thread.text, subject.subject],
            // AWS Secret Access Key: 40-character base64 string
            regex.contains(., '\b[A-Za-z0-9/+=]{40}\b')
    )
  )

detection_methods:
  - "Content analysis"
