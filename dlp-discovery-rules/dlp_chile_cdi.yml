name: "DLP: Chile Identity Card Number"
description: "Detects messages containing Chilean Identity Card (CDI) numbers."
type: "dlp"
severity: "high"
source: |
  type.outbound
  and any([body.current_thread.text, subject.subject],
          // Chilean RUT: 7-8 digits with verification digit
          regex.contains(., '\b\d{1,2}\.\d{3}\.\d{3}-[0-9Kk]\b')
  )
  and any([body.current_thread.text, subject.subject],
          regex.icontains(., 'RUT|c√©dula|identity\s+card|CDI')
  )
  and (
    strings.icontains(sender.email.domain.tld, "cl")
    or strings.icontains(body.current_thread.text, "chile")
  )

detection_methods:
  - "Content analysis"
