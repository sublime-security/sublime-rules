name: "DLP: US ICD-10-CM Code"
description: "Detects messages containing ICD-10-CM diagnosis and procedure codes."
type: "dlp"
severity: "medium"
source: |
  type.outbound
  and any([body.current_thread.text, subject.subject],
          // ICD-10-CM diagnosis: letter + 2 digits + optional dot + up to 4 more alphanumeric
          // ICD-10-PCS procedure: 7 alphanumeric (no I or O)
          regex.contains(., '\b[A-Z]\d{2}\.?[A-Z0-9]{0,4}\b|\b[A-HJ-NP-Z0-9]{7}\b')
  )
  and any([body.current_thread.text, subject.subject],
          regex.icontains(., 'ICD-?10|diagnosis\s+code|procedure\s+code')
  )

detection_methods:
  - "Content analysis"
