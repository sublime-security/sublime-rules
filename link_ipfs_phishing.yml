name: "Link: IPFS string found in URL"
description: "Detects emails containing links that have 'ipfs' in the url path, or contain url shorteners in which 
  the effective url contains 'ipfs'"
references:
  - "https://securelist.com/ipfs-phishing/109158/"
type: "rule"
severity: "medium"
source: |
  type.inbound

  // Any body link domains contain "ipfs"
  and any(body.links, strings.icontains(.href_url.domain.domain, "ipfs")
  
    // Or we didn't submit the URL, and the url contains ipfs and is not common or in org_domains
      or (beta.linkanalysis(.).submitted == false) and any(body.links, strings.icontains(.href_url.url, "ipfs")
      and .href_url.domain.domain not in $free_file_hosts and
          .href_url.domain.domain not in $free_subdomain_hosts and
          .href_url.domain.domain not in $tranco_1m and
          .href_url.domain.domain not in $umbrella_1m and
          .href_url.domain.domain not in $org_domains
      )
  )
tags:
  - "Suspicious link"
