name: "Reply-To local lookalike freemail"
type: "query"
source: |
  map(filter(headers.reply_to,
    length(headers.reply_to) > 0
    and all(headers.reply_to, .email.email != sender.email.email
           and .email.domain.domain in $free_email_providers
           and .email.email not in $sender_emails
           and strings.contains(.email.local_part, sender.email.domain.sld)
  ), .email.email)
severity: "informational"
tags:
  - "Headers"
